<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home - Public Complaint Platform</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="/style.css">

  <style>
    body {
      background: #f1f5f9;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    header {
      background-color: #4d555c ;
    }

    header h1 {
      color: white;
      font-size: 1.5rem;
    }

    nav a, .profile-toggle, .complaints-toggle {
      color: white;
      cursor: pointer;
    }

    nav a:hover, .profile-toggle:hover, .complaints-toggle:hover {
      text-decoration: underline;
    }

    #profileDetails, #comp {
      display: none;
      position: absolute;
      top: 70px;
      right: 20px;
      width: 350px;
      z-index: 1050;
      transition: all 0.3s ease-in-out;
    }

    @media (max-width: 768px) {
      #profileDetails, #comp {
        position: static;
        width: 100%;
        margin-top: 10px;
      }
    }

    .card-custom {
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    .btn-resolve {
      cursor: pointer;
    }

    textarea.form-control {
      resize: none;
    }
  </style>
</head>
<body>
  <%- include("partials/header") %>
<div class="container my-4">

  <% if(mainUser) { %>
  <!-- Profile Panel -->
  <div id="profileDetails" class="card card-custom p-3 bg-white">
    <h5 class="text-success">Profile</h5>
    <hr>
    <p><strong>Username:</strong> <%= mainUser.username %></p>
    <p><strong>Email:</strong> <%= mainUser.email %></p>
    <p><strong>Mobile:</strong> <%= mainUser.mobile %></p>
    <h6 class="mt-3 text-success">Address</h6>
    <p><strong>District:</strong> <%= mainUser.district %></p>
    <p><strong>Taluka:</strong> <%= mainUser.taluka %></p>
    <p><strong>Village:</strong> <%= mainUser.village %></p>
    <p><strong>Role:</strong> <%= mainUser.role %></p>
    <div class="d-flex gap-2 mt-2">
      <form action="/edit/<%=mainUser._id%>">
        <button class="btn btn-primary w-100 btn-sm">Edit Profile</button>
      </form>
      <form action="/logout">
        <button class="btn btn-danger w-100 btn-sm">Logout</button>
      </form>
    </div>
  </div>

  <!-- Complaint Form -->
  <div class="card card-custom p-4 mb-4 bg-white">
    <h5 class="text mb-3">Submit a Complaint</h5>
    <form action="/home2/<%=mainUser.district%>/<%=mainUser.taluka%>/<%=mainUser.village%>/<%=mainUser._id%>" method="POST" enctype="multipart/form-data">
      <div class="mb-3">
        <textarea class="form-control" name="complaint" rows="4" placeholder="Enter your complaint"></textarea>
      </div>
      <div class="mb-3">
        <input type="file" class="form-control" name="file">
      </div>
      <div class="row g-2">
        <div class="col-md-4">
          <input type="text" name="username" value="<%= mainUser.username %>" class="form-control" placeholder="Username">
        </div>
        <div class="col-md-4">
          <input type="text" name="mobile" value="<%= mainUser.mobile %>" class="form-control" placeholder="Mobile">
        </div>
        <div class="col-md-4">
          <input type="text" name="email" value="<%= mainUser.email %>" class="form-control" placeholder="Email">
        </div>
      </div>
      <button type="submit" class="btn btn-success mt-3 w-100" id="btn">Submit</button>
    </form>
  </div>

  <!-- Raised Complaints -->
  <div id="comp" class="card card-custom p-3 bg-white">
    <h5 class="text mb-3">Your Complaints</h5>
    <% if(mainUser.complaint && mainUser.complaint.length > 0) { %>
      <% mainUser.complaint.forEach(com => { %>
        <div class="border-bottom pb-2 mb-2">
          <p><strong>Title:</strong> <%= com.title %></p>
          <p><strong>Description:</strong> <%= com.description %></p>
          <p><strong>From:</strong> <%= com.name %></p>
          <p><strong>Mobile:</strong> <%= com.mobile %></p>
          <p><strong>Email:</strong> <%= com.email %></p>
          <p><strong>Resolved:</strong> <%= com.resolved %></p>
        
        </div>
      <% }) %>
    <% } else { %>
      <p>No complaints submitted yet.</p>
    <% } %>
  </div>
  <% } else { %>
    <p class="text-center mt-4">User not found. Please <a href="/login">login</a>.</p>
  <% } %>

</div>

<!-- Footer -->
<%- include("partials/footer") %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.getElementById("btn")?.addEventListener("click", () => {
    alert("Your complaint has been sent!");
  });

  function toggleProfile() {
    const profile = document.getElementById("profileDetails");
    profile.style.display = (profile.style.display === "none" || profile.style.display === "") ? "block" : "none";
  }

  function toggleComplaints() {
    const comp = document.getElementById("comp");
    comp.style.display = (comp.style.display === "none" || comp.style.display === "") ? "block" : "none";
  }
</script>
</body>
</html>
